// Grammar for DobONoMoDo Expression DSL
//
// This grammar defines the syntax for expressions with:
// - Literals: numbers, strings, booleans, dates, NULL
// - Column references: table.column
// - Binary operators: arithmetic, comparison, logical
// - Unary operators: NOT, negation
// - Function calls: FUNC(arg1, arg2, ...)
// - Parentheses for grouping

WHITESPACE = _{ " " | "\t" | "\r" | "\n" }

// Entry point
expression = { SOI ~ expr ~ EOI }

// Main expression (using PrattParser)
expr = { term ~ (
    (or_op | and_op | eq_op | ne_op | le_op | ge_op | lt_op | gt_op | add_op | sub_op | mul_op | div_op)
    ~ term
)* }

// Terms can have unary operators
term = { unary_op* ~ primary }

// Primary expressions (highest precedence)
primary = {
    literal
    | function_call
    | column_ref
    | "(" ~ expr ~ ")"
}

// Unary operators
unary_op = {
    not_op
    | negate_op
}

not_op = { "NOT" ~ !("(") }
negate_op = { "-" }

// Arithmetic operators
add_op = { "+" }
sub_op = { "-" }
mul_op = { "*" }
div_op = { "/" }

// Comparison operators
eq_op = { "=" }
ne_op = { "<>" }
lt_op = { "<" }
le_op = { "<=" }
gt_op = { ">" }
ge_op = { ">=" }

// Logical operators
and_op = { "AND" }
or_op = { "OR" }

// Literals
literal = {
    null_literal
    | boolean_literal
    | number_literal
    | date_literal
    | string_literal
}

null_literal = { ^"NULL" }
boolean_literal = { ^"TRUE" | ^"FALSE" }
number_literal = @{ ASCII_DIGIT+ ~ ("." ~ ASCII_DIGIT+)? }
string_literal = @{ "\"" ~ (!("\"") ~ ANY)* ~ "\"" }
date_literal = { ^"DATE" ~ "(" ~ string_literal ~ ")" }

// Column reference: table.column
column_ref = @{ identifier ~ "." ~ identifier }

// Function call: FUNC(arg1, arg2, ...)
function_call = { identifier ~ "(" ~ arg_list? ~ ")" }

arg_list = { expr ~ ("," ~ expr)* }

// Identifier (table names, column names, function names)
identifier = @{ (ASCII_ALPHA | "_") ~ (ASCII_ALPHANUMERIC | "_")* }
