# Session Summary — 2026-02-22 (Full Day)

## What Was Accomplished

### Entity & Capability Completion

1. **Resolver entity** (`docs/entities/resolver.md`) — written from completed interview:
   - Configuration-driven DSL with `when` conditions, `data_level`, typed strategies (path/table/catalog)
   - Automatic period expansion via Calendar hierarchy
   - Precedence: Project override → Dataset `resolver_id` → system default
   - Returns `List<ResolvedLocation>`

2. **Period filter mechanism** — resolved OQ-003:
   - `temporal_mode: period | bitemporal` added to **TableRef** (not Dataset — each table independently declares its mode)
   - Period tables: `_period = run_period.identifier` exact match
   - Bitemporal tables: asOf query using `period.start_date`
   - Non-overlap is a data contract, not engine-enforced
   - System columns (`_period`, `_period_from`, `_period_to`, `_deleted`) are reserved, not declared in ColumnDef

3. **Activate Project capability** (`docs/capabilities/activate-project.md`):
   - `draft` = development sandbox (runnable, outputs to sandbox DataSource)
   - `active` = production mode
   - Manual activation with user-confirmed Dataset version pin
   - 9 validation rules (VAL-001–009) — blocks on any error
   - Structural edits revert active → draft; metadata changes don't

4. **RuntimeJoin resolution** — updated `docs/entities/operation.md`:
   - `source` changed from `TableRef` to `dataset_id: UUID + dataset_version: Integer?`
   - Resolved via Resolver with same precedence as input Dataset
   - Period filter uses join table's own `temporal_mode` with Run's current Period
   - Version can be pinned or floating

5. **Execute Test Scenario capability** (`docs/capabilities/execute-test-scenario.md`):
   - Data-driven YAML test harness for both engine dev and end-user contracts
   - Built-in test Resolver, metadata injection, structured diff reporting
   - All 4 open questions resolved (no parameterisation, convention+CLI discovery, timing deferred, version drift = warning)

### Architecture

6. **Framework selection**: Rust + Polars — selected through structured evaluation against Flink, Spark, DuckDB, DataFusion, Go options

7. **System architecture** (`docs/architecture/system-architecture.md`):
   - 3 binaries: API server (axum), Engine Worker (Polars), CLI (clap)
   - Shared `core` library crate with IO injected via traits
   - PostgreSQL metadata store, K8s Jobs for Run dispatch
   - Cargo workspace monorepo

### Implementation Planning

8. **Implementation plan** (`docs/architecture/implementation-plan.md`):
   - 22 fine-grained specs (S00–S21) across 6 phases
   - Dependency graph with parallelism map (up to 8 concurrent specs)
   - Each spec = one `speckit.specify` → `plan` → `tasks` → `implement` cycle

9. **Sample datasets** (`docs/architecture/sample-datasets.md`):
   - Financial/accounting domain: transactions, accounts, cost_centers, exchange_rates (bitemporal), budgets
   - Full sample data rows for all tables
   - 11 test scenario outlines (TS-01 through TS-11)

10. **22 spec prompt.md files** in `docs/specs/S##-*/prompt.md` — each optimised for `speckit.specify`

## Files Created This Session

- `docs/entities/resolver.md`
- `docs/capabilities/activate-project.md`
- `docs/capabilities/execute-test-scenario.md`
- `docs/architecture/system-architecture.md`
- `docs/architecture/implementation-plan.md`
- `docs/architecture/sample-datasets.md`
- `docs/specs/S00-workspace-scaffold/prompt.md` through `docs/specs/S21-api-server/prompt.md` (22 files)

## Files Modified This Session

- `docs/entities/dataset.md` — `temporal_mode` on TableRef (not Dataset), rewritten Row Metadata section with period/bitemporal split, updated BRs 018–022, YAML schema
- `docs/entities/project.md` — added `resolver_overrides`, updated BR-010 (draft = sandbox-runnable), BR-012/012a, rewritten lifecycle table
- `docs/entities/operation.md` — RuntimeJoin `source` → `dataset_id` + `dataset_version`, added BR-008a/b/c, updated YAML schema and example
- `docs/entities/run.md` — added `resolver_snapshots` + `ResolverSnapshot` to ProjectSnapshot
- `docs/capabilities/execute-project-calculation.md` — OQ-003 resolved

## Readiness Assessment

- **All 4 blocking gaps resolved** (Resolver, Period filter, Activate Project, RuntimeJoin)
- **29 open questions remain** (17 Open, 11 Deferred, 1 Resolved) — none blocking for initial implementation
- **Architecture defined** — Rust + Polars + PostgreSQL + K8s
- **22 specs ready** for `speckit.specify` pipeline

## Next Steps

1. Start with **S00** (`speckit.specify` on `docs/specs/S00-workspace-scaffold/prompt.md`)
2. After S00 completes, launch **S01, S02, S16, S17** in parallel
3. Follow the dependency graph in `docs/architecture/implementation-plan.md`
